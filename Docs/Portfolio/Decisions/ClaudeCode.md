# Claude Code 최적화 의사결정

## 서브에이전트 위임 아키텍처

**일자**: 2026-01-21 | **상태**: 결정됨

### 컨텍스트
Claude Code 사용 시 토큰 소모가 크고 컨텍스트가 빠르게 소진되는 문제. 탐색, 문서화, 구현 작업에서 특히 토큰 낭비가 심함.

### 선택지
1. **메인 에이전트 단독** - 모든 작업 직접 수행. 컨텍스트 빠르게 소진.
2. **서브에이전트 전면 위임** - 모든 작업 위임. 오버헤드 발생.
3. **하이브리드** - 복잡한 작업만 위임, 단순 작업은 직접. (선택)

### 결정
하이브리드 방식 채택:
- **메인**: 검토/의사결정/단일 파일 수정
- **서브**: 3+ 파일 탐색, 아키텍처 분석, 문서화, 기능 구현

### 결과
- 메인 컨텍스트에 결과 요약만 보존
- 상세 내용은 파일로 출력 후 경로 참조

---

## 서브에이전트 모델 전략

**일자**: 2026-01-21 | **상태**: 결정됨 (수정)

### 컨텍스트
서브에이전트에 haiku 사용 시 비용 절감되나 품질 저하 우려.

### 선택지
1. **haiku** - 저비용, 속도 빠름, 품질 낮음
2. **sonnet** - 균형
3. **opus** - 고품질, 고비용

### 결정
작업 유형별 차등 적용:
- **설계/문서 (`code-architect`)**: opus - 고품질 판단 필요
- **코드 리뷰 (`code-reviewer`)**: opus - 정확한 이슈 탐지
- **탐색/구현**: sonnet - 균형

---

## Skills 온디맨드 로딩

**일자**: 2026-01-21 | **상태**: 결정됨

### 컨텍스트
CLAUDE.md에 상세 지침 포함 시 매 요청마다 토큰 소비.

### 선택지
1. **CLAUDE.md에 모두 포함** - 항상 로딩, 토큰 낭비
2. **Skills 분리** - 필요시만 로딩 (선택)

### 결정
3개 스킬로 분리:
- `/explore` - 탐색 프로토콜
- `/implement` - 구현 프로토콜
- `/document` - 문서화 프로토콜

### 결과
초기 컨텍스트 약 50% 감소 예상.

---

## Hooks 자동화

**일자**: 2026-01-21 | **상태**: 결정됨

### 컨텍스트
"포맷팅 해줘" 같은 반복 요청으로 토큰 낭비.

### 결정
PostToolUse hook으로 C# 파일 자동 포맷팅:
```json
{
  "matcher": { "tool": "Write", "glob": "**/*.cs" },
  "command": "dotnet format"
}
```

### 결과
프롬프트에서 포맷팅 관련 지시 제거 가능.

---

## Extended Thinking 조절

**일자**: 2026-01-21 | **상태**: 결정됨

### 컨텍스트
기본 thinking budget 31,999 토큰은 단순 작업에 과도.

### 결정
budget을 기본값의 절반(16,000)으로 설정.

---

## 커스텀 커맨드

**일자**: 2026-01-21 | **상태**: 결정됨

### 결정
반복 워크플로우를 커맨드로 캡슐화:
- `/analyze {대상}` - 분석 → 설계안
- `/impl {기능}` - 분석 → 구현 → 검증
- `/review {대상}` - 코드 리뷰

---

## 컨텍스트 관리 규칙

**일자**: 2026-01-21 | **상태**: 결정됨

### 결정
- `/clear` - 작업 전환 시
- `/compact` - 70% 용량 도달 또는 20회 반복 시

---

## 적용 파일 목록

| 파일 | 용도 |
|------|------|
| `CLAUDE.md` | 핵심 규칙 (76줄로 압축) |
| `.claude/settings.local.json` | hooks, thinking budget |
| `.claude/skills/explore/SKILL.md` | 탐색 프로토콜 |
| `.claude/skills/implement/SKILL.md` | 구현 프로토콜 |
| `.claude/skills/document/SKILL.md` | 문서화 프로토콜 |
| `.claude/commands/analyze.md` | 분석 커맨드 |
| `.claude/commands/impl.md` | 구현 커맨드 |
| `.claude/commands/review.md` | 리뷰 커맨드 |
| `.claude/MULTI_SESSION.md` | 멀티세션 규칙 (분리) |
